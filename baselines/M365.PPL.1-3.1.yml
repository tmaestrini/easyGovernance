Topic: Power Platform
Type: Baseline
Id: M365.1-3.1
Version: 1.0

References:
  - https://www.cisa.gov/resources-tools/services/m365-power-platform

Configuration:
  - enforces: Environments
    with:
      DefaultEnvironment:
        Name: "Personal Productivity (default)" # Specifies the default environment name.
        Monitoring: true # Specifies whether the monitoring is enabled
      DevelopmentEnvironments:
        Monitoring: true # Specifies whether the monitoring is enabled
        DisableEnvironmentCreationByNonAdminUsers: true # Specifies whether the developer environment creation by non-admin users is disabled
      ProductionEnvironments:
        Monitoring: true # Specifies whether the monitoring is enabled
        DisableEnvironmentCreationByNonAdminUsers: true # Specifies whether the environment creation by non-admin users is disabled
      TrialEnvironments:
        Monitoring: true # Specifies whether the monitoring is enabled
        DisableEnvironmentCreationByNonAdminUsers: true # Specifies whether the trial environment creation by non-admin users is disabled
      
  - enforces: DataPolicies
    with:
      DefaultEnvironment:
        PolicyName: Default # Specifies the default environment policy name (should be 'Default' for clarity)
        AllowedCoreConnectors: # Specifies the allowed core connectors
          - "/providers/Microsoft.PowerApps/apis/shared_sharepointonline"
          - "/providers/Microsoft.PowerApps/apis/shared_office365users"
          - "/providers/Microsoft.PowerApps/apis/shared_onedriveforbusiness"
          - "/providers/Microsoft.PowerApps/apis/shared_approvals"
          - "/providers/Microsoft.PowerApps/apis/shared_commondataservice"
          - "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
          - "/providers/Microsoft.PowerApps/apis/shared_excelonlinebusiness"
          - "/providers/Microsoft.PowerApps/apis/shared_microsoftformspro"
          - "/providers/Microsoft.PowerApps/apis/shared_office365"
          - "/providers/Microsoft.PowerApps/apis/shared_office365groups"
          - "/providers/Microsoft.PowerApps/apis/shared_onenote"
          - "/providers/Microsoft.PowerApps/apis/shared_planner"
          - "/providers/Microsoft.PowerApps/apis/shared_powerappsnotification"
          - "/providers/Microsoft.PowerApps/apis/shared_powerappsnotificationv2"
          - "/providers/Microsoft.PowerApps/apis/shared_powerbi"
          - "/providers/Microsoft.PowerApps/apis/shared_shifts"
          - "/providers/Microsoft.PowerApps/apis/shared_teams"
          - "/providers/Microsoft.PowerApps/apis/shared_todo"
          - "/providers/Microsoft.PowerApps/apis/shared_yammer"
      NonDefaultEnvironments:
        AtLeastOneActivePolicy: true # Specifies whether at least one active policy is required for non-default environments
    References:
      DefaultEnvironment:
        AllowedCoreConnectors: "The following connectors drive core Power Platform functionality and should be allowed in 'Business' section: Approvals, Dynamics 365 Customer Voice, Excel Online (Business), Microsoft Dataverse, Microsoft Dataverse (legacy), Microsoft Teams, Microsoft To -Do (Business), Office 365 Groups, Office 365 Outlook, Office 365 Users, OneDrive for Business, OneNote (Business), Planner, Power Apps Notification, Power BI, SharePoint, Shifts for Microsoft Teams, and Viva Engage (ex Yammer)."

  - enforces: SecuritySettings
    with:
      TenantIsolation: 
        IsolationControl: On # Specifies whether the tenant isolation is enabled; can be 'On' or 'Off'
      ContentSecurityPolicy:
        CanvasApps: true # Specifies whether the content security policy is enabled for canvas apps
        ModelDrivenApps: true # Specifies whether the content security policy is enabled for model-driven apps
        EnableReportingViolations: true # Specifies whether the reporting of violations is enabled
        EnableForDefaultEnvironment: true # Specifies whether the content security policy is enabled for the default environment
        EnableForDevelopmentEnvironments: true # Specifies whether the content security policy is enabled for development environments
        EnableForProductionEnvironments: true # Specifies whether the content security policy is enabled for production environments
    references:
      - TenantIsolation: "Power Platform tenant isolation only works for connectors using Microsoft Entra-based authentication, such as Office 365 Outlook or SharePoint.  Once tenant isolation is turned on, inbound (connections to the tenant from external tenants) and outbound (connections from the tenant to external tenants) cross-tenant connections are blocked by Power Platform, even if the user presents valid credentials to the Microsoft Entra-secured data source."

  - enforces: PowerAutomate
    with:
      DisableFlowRunResubmission: false # Specifies whether the flow run resubmission is disabled; set to 'true' to disable
    references:
      - DisableFlowRunResubmission: "n/a"